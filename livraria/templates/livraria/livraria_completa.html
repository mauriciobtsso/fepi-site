{% extends 'core/base.html' %}
{% load static %}

{% block title %}Livraria Ramiro Gama - Cat√°logo{% endblock %}

{% block extra_css %}
<style>
    /* Cabe√ßalho */
    .livraria-header { text-align: center; margin-bottom: 30px; }
    .livraria-header h1 { color: var(--azul-escuro); margin-bottom: 10px; }

    /* √Årea de Busca e Filtros */
    .filtros-container { 
        background-color: var(--azul-claro); padding: 25px; 
        border-radius: var(--radius); margin-bottom: 40px; 
    }

    /* Busca */
    .search-form { display: flex; max-width: 600px; margin: 0 auto 20px; gap: 10px; }
    .search-input { flex: 1; padding: 10px 20px; border-radius: 30px; border: 1px solid #ccc; outline: none; }
    .search-btn { background-color: var(--azul-escuro); color: white; border: none; padding: 0 25px; border-radius: 30px; cursor: pointer; }

    /* Tags de Categoria */
    .tags-wrapper { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    .tag-link {
        text-decoration: none; font-size: 0.85rem; padding: 6px 15px;
        border-radius: 20px; border: 1px solid var(--azul-medio);
        color: var(--azul-medio); transition: 0.2s; background: white;
    }
    .tag-link:hover, .tag-link.active {
        background-color: var(--azul-medio); color: white;
    }

    /* GRID COMPACTO DE LIVROS */
    .catalogo-grid { 
        display: grid; 
        /* Colunas estreitas (m√≠nimo 160px) para caberem 4 ou 5 por linha */
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
        gap: 25px; 
    }

    .card-livro { 
        background: white; border-radius: 8px; overflow: hidden; 
        transition: 0.3s; border: 1px solid #eee; position: relative;
        display: flex; flex-direction: column; text-decoration: none;
        height: 100%;
    }
    .card-livro:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
        border-color: var(--dourado);
    }

    /* Imagem */
    .capa-wrapper {
        width: 100%; height: 240px; /* Altura fixa da capa */
        background-color: #f9f9f9; position: relative; overflow: hidden;
        border-bottom: 1px solid #f0f0f0;
    }
    .capa-livro { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
    .card-livro:hover .capa-livro { transform: scale(1.05); }

    /* Info */
    .info-livro { padding: 12px; text-align: center; flex: 1; display: flex; flex-direction: column; }
    
    .titulo { 
        font-weight: 700; color: var(--azul-escuro); margin-bottom: 4px; 
        font-size: 0.95rem; line-height: 1.2;
    }
    .autor { color: #777; font-size: 0.8rem; margin-bottom: 8px; flex: 1; }
    
    .preco-badge {
        background-color: var(--azul-claro); color: var(--azul-escuro);
        font-weight: 800; font-size: 0.9rem; padding: 4px 10px; border-radius: 4px;
        align-self: center; margin-top: auto;
    }

</style>
{% endblock %}

{% block content %}
<div class="container">
    
    <div class="livraria-header">
        <h1>Livraria Ramiro Gama</h1>
        <p>Cat√°logo de obras esp√≠ritas dispon√≠veis para pronta entrega.</p>
    </div>

    <div class="filtros-container">
        <form method="GET" action="." class="search-form">
            <input type="text" name="q" class="search-input" placeholder="Buscar livro ou autor..." value="{{ busca_ativa|default:'' }}">
            <button type="submit" class="search-btn">üîç</button>
        </form>

<div class="tags-wrapper">
            <a href="{% url 'livraria' %}" class="tag-link {% if not cat_ativa %}active{% endif %}">Todos</a>
            
            {% for cat in categorias %}
            <a href="?cat={{ cat.id }}" class="tag-link {% if cat_ativa == cat.id %}active{% endif %}">
                {{ cat.nome }}
            </a>
            {% endfor %}
        </div>
    </div>

    <div class="catalogo-grid">
        {% for livro in livros %}
        <a href="{% url 'detalhe_livro' livro.id %}" class="card-livro">
            <div class="capa-wrapper">
                {% if livro.capa %}
                    <img src="{{ livro.capa.url }}" class="capa-livro" alt="{{ livro.titulo }}">
                {% else %}
                    <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#ccc; font-size:2rem;">üìö</div>
                {% endif %}
            </div>
            
            <div class="info-livro">
                <div class="titulo">{{ livro.titulo|truncatechars:35 }}</div>
                <div class="autor">{{ livro.autor }}</div>
                <div class="preco-badge">R$ {{ livro.preco }}</div>
            </div>
        </a>
        {% empty %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 60px;">
            <p style="color:#888; font-size:1.2rem;">Nenhum livro encontrado com esses filtros.</p>
            <a href="{% url 'livraria' %}" style="color:var(--azul-medio); font-weight:bold;">Limpar filtros</a>
        </div>
        {% endfor %}
    </div>

</div>
{% endblock %}